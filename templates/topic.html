<!DOCTYPE html>
<html lang="fr">
{{template "InitPage" .}}
<body>
    <!-- Header -->
   {{template "ForumHeader" .}}

<!-- Main Content -->
<div class="dashboard-header">
  <div class="topic-top">
    <h2>{{.Topic.Name}}</h2>
     {{if .CurrentUser.LogStatus}}<button class="respond-btn" onclick="showResponseBox(this)">R√©pondre</button>{{end}}
  </div>
</div>

<main class="main-content">

    <!-- Sidebar -->
      <aside class="sidebar">
        {{range .Topic.Messages}}
        ‚Ä¢ <a href="#{{.MessageID}}">Message du {{.Created}}</a> par <a href="/user/{{.Author.ID}}">{{.Author.Username}}</a>
      <br>
      {{end}}
      </aside>

  <!-- Posts Section -->
   
        <section class="posts-section">
            {{range .Topic.Messages}}
            <div class="post-card" id="{{.MessageID}}">
                <div class="post-avatar">{{.Author.ProfilPic}}</div>
                <div class="post-content">
                    <div class="post-title">{{.Author.Username}}</div>
                    <pre class="post-text">{{.Content}}</pre>
                <div class="actions-column">
                      <div class="menu">
                            <button class="menu-btn">‚ãÆ</button>
                            <div class="menu-options">
                                <button style="display:block; width:100%; padding:10px; border:none; background:none; text-align:left; cursor:pointer;">supprimer</button>
                                <button style="display:block; width:100%; padding:10px; border:none; background:none; text-align:left; cursor:pointer;">signaler</button>
                            </div>
                        </div>
                </div>
                </div>

                {{if $.CurrentUser.LogStatus}}<div class="post-actions">
                   <form method="POST" action="/like" class="like-form">
            <input type="hidden" name="postID" value="{{.MessageID}}">
            <button type="submit" class="action-btn">
                <span>üëç</span>
                <span>{{.Likes}}</span>
            </button>
                    </form>
                    <form method="POST" action="/dislike" class="like-form">
            <input type="hidden" name="postID" value="{{.MessageID}}">
            <button type="submit" class="action-btn">
                <span>üëé</span>
                <span>{{.Dislikes}}</span>
            </button>
                    </form>
                    
                </div>
                {{end}}
            </div>
            {{end}}

        </section>
        </main>
    </div>

    <!-- Modal de r√©ponse -->
   {{template "ReponseBox"}}

     

    <script>       
        // Animation au scroll
        window.addEventListener('scroll', () => {
            const posts = document.querySelectorAll('.post');
            posts.forEach(post => {
                const rect = post.getBoundingClientRect();
                if (rect.top < window.innerHeight && rect.bottom > 0) {
                    post.style.opacity = '1';
                    post.style.transform = 'translateY(0)';
                }
            });
        });

        // Recherche en temps r√©el (simulation)
        document.querySelector('.search-bar').addEventListener('input', function(e) {
            const query = e.target.value.toLowerCase();
            const posts = document.querySelectorAll('.post');
            
            posts.forEach(post => {
                const content = post.querySelector('.post-content').textContent.toLowerCase();
                const username = post.querySelector('.username').textContent.toLowerCase();
                
                if (content.includes(query) || username.includes(query) || query === '') {
                    post.style.display = 'block';
                } else {
                    post.style.display = 'none';
                }
            });
        });

    </script>
</body>
</html>
